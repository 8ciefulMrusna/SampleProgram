@*
    // OAuth 2.0 テスト用 画面なので、必要に応じて流用 or 削除して下さい。

    //**********************************************************************************
    //* Copyright (C) 2017 Hitachi Solutions,Ltd.
    //**********************************************************************************

    #region Apache License
    //
    // Licensed under the Apache License, Version 2.0 (the "License");
    // you may not use this file except in compliance with the License.
    // You may obtain a copy of the License at
    //
    // http://www.apache.org/licenses/LICENSE-2.0
    //
    // Unless required by applicable law or agreed to in writing, software
    // distributed under the License is distributed on an "AS IS" BASIS,
    // WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    // See the License for the specific language governing permissions and
    // limitations under the License.
    //
    #endregion

    //**********************************************************************************
    //* クラス名        ：OAuth2Redirect
    //* クラス日本語名  ：OAuth2Redirect（テスト用）
    //* ・この画面は、OAuth2のテスト用画面です。テストのためこの画面はbearer tokenを露見させます。本番環境にこの画面を提供しないで下さい。
    //* ・This screen is the test screen of OAuth 2. This screen exposes bearer token for testing. Do not provide this screen for production environment.
    //*
    //* 作成日時        ：－
    //* 作成者          ：－
    //* 更新履歴        ：－
    //*
    //*  日時        更新者            内容
    //*  ----------  ----------------  -------------------------------------------------
    //*  2017/04/24  西野 大介         新規
    //**********************************************************************************
*@

@{
    ViewData["Title"] = "OAuth2Redirect";
}

@section Scripts {
    <script type="text/javascript">

        var fragment = "";
        var token = "";
        
        $(function () {
            // フラグメントを取得し、
            fragment = getFragment();

            // フラグメントに access_token (Bearer Token) がある場合、
            if (fragment.access_token) {

                // access_token (Bearer Token) を使用して
                // ResourceServerのWebAPIにアクセスする。
                token = fragment.access_token;

                // 「access_token」（Bearer Token）が
                // "露見"しないようwindow.location.hashを消去。
                // ~~~~~~
                window.location.hash = fragment.state || '';

                // Custom URL Schemeでネイティブ（ハイブリッド）に遷移。
                window.location.href = 'otrcdvtpl://' + token;
                //document.location.href = 'otrcdvtpl://' + token;

                // What's the difference between window.location and document.location in JavaScript? - Stack Overflow
                // https://stackoverflow.com/questions/2430936/whats-the-difference-between-window-location-and-document-location-in-javascrip
                //   According to the W3C, they are the same. In reality, for cross browser safety, you should use window.location rather than document.location.

                // javascript - Redirection to custom URL scheme not working - Stack Overflow
                // https://stackoverflow.com/questions/45325605/redirection-to-custom-url-scheme-not-working
                //window.location.replace('otrcdvtpl://' + token);
            }
        });
    </script>
}
